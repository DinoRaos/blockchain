<!DOCTYPE html>
<html lang="de">

<head>
  <meta charset="UTF-8" />
  <title>BlockBazaar – Kaufen</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet" />
  <link rel="icon" href="{{ url_for('static', filename='images/favicon.ico') }}" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" />
</head>

<body>
  {% include 'navbar.html' %}
  

  <section class="py-5">
    <div class="container">
      <h2 class="mb-4">Gegenstände kaufen</h2>
      <div id="itemList" class="row">
        {% for item in items %}
        <div class="col-md-4">
          <div class="card mb-4">
            <div class="image-container">
              <img src="{{ item.image_url }}" class="card-img-top" alt="{{ item.name }}" />
            </div>
            <div class="card-body">
              <h5 class="card-title">{{ item.name }}</h5>

              <p class="card-text" id="descText{{ item.id }}" data-expanded="false"
                data-fulltext='{{ item.description|tojson|safe }}'>
                {{ item.description[:100] }}{% if item.description|length > 100 %}...{% endif %}
              </p>

              {% if item.description|length > 100 %}
              <button class="btn btn-outline-secondary btn-sm mt-2 d-flex align-items-center gap-1" type="button"
                onclick="toggleDescription('descText{{ item.id }}', this)">
                <i class="bi bi-chevron-down"></i> Mehr anzeigen
              </button>
              {% endif %}

              <div class="seller-info mt-3">
                <!-- Bootstrap Icon anstelle des Bildes -->
                <i class="bi bi-person-circle seller-icon"></i>
                <span class="seller-address">{{ item.seller_address }}</span>
              </div>
              <div class="price-info mt-2">
                <img src="https://upload.wikimedia.org/wikipedia/commons/0/01/Ethereum_logo_translucent.svg" alt="ETH"
                  class="eth-icon me-1" width="16" />
                <span class="eth-price fw-bold">{{ item.price_eth }} ETH</span>
              </div>
              <button class="btn btn-success mt-3 w-100" onclick="buyItem('{{ item.id }}', '{{ item.price_eth }}')">
                Kaufen
              </button>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
  </section>

  <!-- Ethers.js, Bootstrap-Bundle & dein Buy-Skript -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="{{ url_for('static', filename='js/buy_transaction.js') }}"></script>

  <script>
    function toggleDescription(elementId, button) {
      const descElem = document.getElementById(elementId);
      const dataFulltext = descElem.getAttribute('data-fulltext');

      if (!dataFulltext) {
        console.error('Kein gültiger data-fulltext gefunden.');
        return;
      }

      let fullText;
      try {
        fullText = JSON.parse(dataFulltext);
      } catch (e) {
        console.error('JSON.parse-Fehler:', e, 'mit data-fulltext:', dataFulltext);
        return;
      }

      if (descElem.getAttribute('data-expanded') === 'false') {
        descElem.innerHTML = fullText;
        descElem.setAttribute('data-expanded', 'true');
        button.innerHTML = '<i class="bi bi-chevron-up"></i> Weniger anzeigen';
      } else {
        const truncatedText = fullText.substring(0, 100);
        descElem.innerHTML = truncatedText + '...';
        descElem.setAttribute('data-expanded', 'false');
        button.innerHTML = '<i class="bi bi-chevron-down"></i> Mehr anzeigen';
      }
    }
  </script>

</body>

</html>